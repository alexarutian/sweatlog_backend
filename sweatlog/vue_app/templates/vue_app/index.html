{% extends "base_generic.html" %} {% block content %} {% load static %}
<body>
  <div id="vue-app">
    <div id="website-footer">
      <div id="footer-content">
        <footertoolbar :menuitems="menuitems"></footertoolbar>
      </div>
    </div>
    <div id="main-content">
      {% csrf_token %}
      <div class="page-wrapper">
        <loginorcreateuser v-if="page == 'login'"></loginorcreateuser>
        <agenda v-if="page == 'agenda'"></agenda>
        <workouts v-else-if="page == 'workouts'"></workouts>
        <blocks v-else-if="page == 'blocks'"></blocks>
        <exercises v-else-if="page == 'exercises'"></exercises>
        <other v-else-if="page == 'other'"></other>
      </div>
    </div>
    <div id="user-token" data-token="{{user_token}}"></div>
  </div>
</body>
<script type="module">
  const availH = parseInt(window.innerHeight);
  document.getElementsByTagName("body").item(0).style.height = availH + "px";

  //   const staticDir = "{% static vue_app %}";
  import { Agenda } from "{% static 'vue_app/components/main/agenda.js' %}";
  import { Workouts } from "{% static 'vue_app/components/main/workouts.js' %}";
  import { Blocks } from "{% static 'vue_app/components/main/blocks.js' %}";
  import { Exercises } from "{% static 'vue_app/components/main/exercises.js' %}";
  import { Other } from "{% static 'vue_app/components/main/other.js' %}";
  import { FooterToolbar } from "{% static 'vue_app/components/main/footertoolbar.js' %}";
  import { LoginOrCreateUser } from "{% static 'vue_app/components/main/loginorcreateuser.js' %}";
  import { store } from "{% static 'vue_app/js/store.js' %}";

  let { createApp } = Vue; // import multiple things from Vue

  const myApp = createApp({
    delimiters: ["[[", "]]"], //default of brackets collides with Django syntax
    components: {
      agenda: Agenda,
      workouts: Workouts,
      blocks: Blocks,
      exercises: Exercises,
      other: Other,
      footertoolbar: FooterToolbar,
      loginorcreateuser: LoginOrCreateUser,
    },
    data() {
      return {
        menuitems: [
          { id: 1, name: "Agenda", page: "agenda" },
          { id: 2, name: "Workouts", page: "workouts" },
          { id: 3, name: "Blocks", page: "blocks" },
          { id: 4, name: "Exercises", page: "exercises" },
          { id: 5, name: "Other", page: "other" },
        ],
      };
    },
    methods: {},
    computed: {
      page() {
        // CHANGE OUT TO OTHER LOGIC
        if (this.$store.state.userToken) {
          return this.$store.state.currentPage;
        } else {
          return "login";
        }
      },
    },
    created() {
      this.$store.dispatch("getUserEmail", {
        data: this.$store.state.userToken,
      });
    },
  });

  myApp.use(store);

  // make sure token is ready before app is mounted
  const userToken = document.getElementById("user-token").dataset.token;
  const csrfToken = getCookie("csrftoken");
  store.commit("updateTokens", { userToken, csrfToken });

  myApp.mount("#vue-app");
</script>
<style>
  #vue-app {
    height: 100%;
    width: 100%;
    display: flex;
    flex-direction: column;
  }

  #main-content {
    height: 86vh;
    flex-grow: 1;
    flex-shrink: 0;
    overflow-y: auto;
  }

  #website-footer {
    background-color: green;
    height: 7vh;
    flex-grow: 0;
    flex-shrink: 0;
    position: fixed;
    bottom: 0;
    width: 100%;
  }

  #footer-content {
    height: 100%;
  }

  .page-wrapper {
    padding-bottom: 8vh;
  }
</style>
{% endblock %}
